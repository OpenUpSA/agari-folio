@folio = http://127.0.0.1:8000/
#@folio = https://folio-staging.openup.org.za


@realm = agari
@client_id = dms
@client_secret = VDyLEjGR3xDQvoQlrHq5AB6OwbW0Refc

@username = system.admin@agari.tech
@password = pass123

### Get access token
# @name login
POST https://keycloak-ilifu.openup.org.za/realms/{{realm}}/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

username={{username}}
&password={{password}}
&grant_type=password
&client_id={{client_id}}
&client_secret={{client_secret}}

###
@token = {{login.response.body.access_token}}

##########################
### 1. Get user id 
##########################
# @name create_users
POST {{folio}}/users/
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "email":"michael@openup.org.za",
  "redirect_uri":"http://agari.openup.org.za",
  "send_email": false
}

##########################
### 2. Send invite to user
##########################
@project_id = 3524d7dc-3961-44a8-bec7-13d942030be4
@project_id = 54289e28-6598-4333-b6b0-e6d8fe11912a

# @name add_project_users
POST {{folio}}/projects/{{project_id}}/users
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "user_id": "e9f23458-7fb1-484a-bf30-82db540c362e",
    "role": "project-viewer",
    "redirect_uri": "http://127.0.0.1"
}

##########################
### 3. Email directs user to the frontend with a URL similar to 
### https://agari-staging.openup.org.za/accept-invite?userid=887d7ebc-9e5e-47ae-bf1c-8562f48bdad7&token=5460558cfec1e17fb18693a036eac41d
### Use the token in the request below to confirm the invite 
##########################
@inv_token = 5ddb8337c53932165b1ccadd3e6472d5

# @name accept_project_invite
POST {{folio}}/invites/project/{{inv_token}}/accept

###

# @name get_project_invites
GET {{folio}}/invites/project/{{project_id}}

###

# @name delete_project_invite
DELETE {{folio}}/invites/project/{{project_id}}